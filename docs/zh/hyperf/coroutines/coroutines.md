---
sidebar: 'auto'

---

# 协程

::: tip 【引言】
了解协程前，先了解下传统的`PHP-FPM` 的工作模式。`PHP-FPM` 本质上是一个进程管理器，实现了 `FastCGI` 协议。
当请求发送到 `Nginx` 或者 `Apache` 后，`Nginx` 通过 `FastCGI` 协议将请求转发给 `PHP-FPM` 处理，`PHP-FPM` fork对应的 `work`
进程来执行 `PHP` 脚本。执行完后回收该进程。整个过程是 `同步阻塞` 的。当大量请求并发请求时，创建的进程会非常多，并且创建、销毁进程占用资源是非常大的。同时，多进程下会产生大量的 `MySQL` 连接，此时数据库
也会产生瓶颈。

---

为了解决传统FPM的痛点，我们容易想到的是单个进程内开启多个线程来处理多个请求或者并发问题，但是从代码级别上来说，PHP并不支持多线程，其次，多线程
有许多问题需要额外考虑，多线程读写加锁问题(CPU调度)、锁的颗粒度、死锁问题、线程异常可能导致整个进程崩溃。那么，这时就可以采用 `协程` 来解决问题。

---
![swoole进程线程模型图](http://img.tzf-foryou.com/img/20220326191804.png)

:::

