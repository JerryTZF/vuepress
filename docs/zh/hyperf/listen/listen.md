---
sidebar: 'auto'

prev: /zh/hyperf/hyperf-component.md
next: /zh/hyperf/crontab/crontab.md

---

# 事件机制

::: tip
- 事件共分为三个角色：`触发器` 、 `监听器` 、 `事件`
- 事件可以分为系统事件、自定义事件；对于系统事件，可以直接写监听器进行监听，[详见图](https://hyperf.wiki/2.2/zh-cn/imgs/hyperf-events.svg)
- 对应关系：![](http://img.tzf-foryou.com/img/20220321102539.png)
:::

---

## 事件

事件`(Event)`可以理解为：`钩子(Hook)` :hook: 或者 `锚点(Anchor)` :anchor: \
在需要的地方，可以埋入适合当前场景的**钩子**；执行当前场景时，可以通过钩子，触发`监听该钩子的所有的监听器`执行业务逻辑。

---

## 触发器(事件调度器)

我们此时已经知道钩子的作用，那么钩子和监听器之间是如何联系起来的呢？这里就需要触发器实现，由上图看出，一个触发器可以触发一个事件，
只有当触发器触发事件后，监听该事件(钩子)的监听器才可以正常监听到该事件，so，**只有触发器(事件调度器)触发该事件，监听该事件的监听器才会生效!!!**

---

## 监听器

监听器是触发事件后业务逻辑实现的地方，在监听事件时，一定要注意事件是否被触发，不然不会被监听器监听到。不同的监听器应该是责任清晰的，
切不可把所有的不同情况下业务逻辑写到一个监听器中，直接梭哈；例如注册后触发短信、Email发送，虽然写在一个监听器中可以实现，但是这种是
不优雅的，没有弄明白为什么要用事件机制的。:x:

---


## 注意事项

- `事件(钩子)` 与 `监听器` 之间是 `多对多` 的关系。即：一个事件可以被多个监听器监听，例如`注册事件`，可以有`注册后发邮件监听器`、`注册后发短信监听器`
等等。多个事件被一个监听器监听，例如`服务启动前事件`、`服务启动成功事件`、`服务退出后事件`，被一个监听器监听，对于不同的事件做出不同的业务逻辑处理。
- 事件一定要按照某种规则进行划分，常见的：`xxx前`、`xxx成功` 、`xxx后`。其次，事件的监听器如果只有一个，那么把业务逻辑同步写在对应的位置也没什么不可。
所以监听器的优势就在于：**一个节点触发多种逻辑，多种逻辑可以清晰的放在不同的监听器中执行，而钩子所在处代码无需变更，本质上是解耦。**
- 很多的系统事件已经被触发器触发，只需要添加自己的监听器即可，但是有一些是不在协程环境下触发，所以在监听系统事件时，一定要注意是否是协程安全。